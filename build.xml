<?xml version="1.0"?>

<!-- This is the main build file for the caldav classes and servers.

     Authors: Mike Douglass   douglm@rpi.edu
-->

<project name="caldav" default="build-all">
  <property environment="env"/>
  <!-- These may already be set from calling dir -->
  <dirname property="org.bedework.project.caldav" file="${ant.file}"/>
  <dirname property="project.home" file="${ant.file}"/>

  <property file="${project.home}/build.properties" />

  <property name="project.name" value="${org.bedework.package.name}"/>
  <property name="project.version" value="${org.bedework.version}"/>

  <property name="dist.home" location="${project.home}/dist"/>
  <property name="lib.dir" location="${project.home}/lib"/>

  <property name="build.dir" location="${project.home}/build"/>
  <property name="buildjar" location="${build.dir}/buildjar.xml"/>

  <property name="org.bedework.libcache.dir"
            location="${project.home}/libcache"/>

  <import file="${build.dir}/getJar.xml"/>

  <!-- =================================================================
       init:
       ================================================================= -->

  <target name="init">
    <delete dir="${lib.dir}" />
    <mkdir dir="${lib.dir}" />

    <getJar name="commons-httpclient" version="3.0" />
    <getJar name="gdata-calendar" version="1.0" />
    <getJar name="gdata-client" version="1.0" />
    <getJar name="ical4j" version="head" />
    <getJar name="log4j" version="1.2.8" />
    <getJar name="servletapi" version="2.4" />

    <getJar name="bw-annotations" version="3.5" project="calendarapi" />
    <getJar name="bw-apiutil" version="3.5" project="calendarapi" />
    <getJar name="bw-calfacade" version="3.5" project="calendarapi" />
    <getJar name="bw-calsvci" version="3.5" project="calendarapi" />
    <getJar name="bw-client" version="3.5" project="calendarapi" />
    <getJar name="bw-davio" version="3.5" project="davutil" />
    <getJar name="bw-icalendar" version="3.5" project="calendarapi" />
    <getJar name="bw-webdavserver" version="3.5" project="webdav" />
    <getJar name="rpiaccess" version="3.5" project="access" />
    <getJar name="rpiutil" version="3.5" project="rpiutil" />

    <property name="org.bedework.caldav.boeingexchange.base"
              location="${project.home}/boeingexchange" />
    <property name="org.bedework.caldav.bwcaldav.base"
              location="${project.home}/bwcaldav" />
    <property name="org.bedework.caldav.domino.base"
              location="${project.home}/domino" />
    <property name="org.bedework.caldav.google.base" location="${project.home}/google" />
    <property name="org.bedework.caldav.server.base" location="${project.home}/server" />
    <property name="org.bedework.caldav.client.base" location="${project.home}/client" />

    <mkdir dir="${dist.home}" />

    <property name="test.data.dir"
              location="${dist.home}/test-data" />

    <property name="edu.rpi.cmt.empty.dir"
              location="${dist.home}/empty-dir" />
    <mkdir dir="${edu.rpi.cmt.empty.dir}" />

    <fileset id="empty.fileset" dir="${edu.rpi.cmt.empty.dir}"
             excludes="*" />
    <!-- default to empty -->
    <fileset id="base.resource.files" refid="empty.fileset" />

    <property name="boeingexchange.jar"
              location="${dist.home}/${edu.rpi.cmt.caldav.boeingexchange.jar}-${project.version}.jar" />

    <property name="bwcaldav.jar"
              location="${dist.home}/${edu.rpi.cmt.caldav.bwcaldav.jar}-${project.version}.jar" />

    <property name="domino.jar"
              location="${dist.home}/${edu.rpi.cmt.caldav.domino.jar}-${project.version}.jar" />

    <property name="google.jar"
              location="${dist.home}/${edu.rpi.cmt.caldav.google.jar}-${project.version}.jar" />

    <property name="server.jar"
              location="${dist.home}/${edu.rpi.cmt.caldav.server.jar}-${project.version}.jar" />

    <!-- ==================== Compilation Classpath ==================== -->

    <path id="compile.classpath">
      <fileset dir="${lib.dir}">
         <include name="**/*.jar"/>
      </fileset>
      <fileset dir="${dist.home}">
         <include name="*.jar"/>
      </fileset>
    </path>
  </target>

  <!-- =================================================================
       Clean out all library files from other projects and all generated
       files in preparation for a complete rebuild.

       Needed because switching versions leaves a load of old bedework
       generated stuff in the libraries.
       ================================================================= -->
  <target name="deep-clean" depends="clean">
    <delete dir="${lib.dir}" />
  </target>

  <!-- =================================================================
       Clean all generated files
       ================================================================= -->
  <target name="clean">
    <delete dir="${dist.home}" />
  </target>

  <!-- =================================================================
       Clean up after a build.
       ================================================================= -->
  <target name="cleanup">
    <delete dir="${edu.rpi.cmt.empty.dir}" />
  </target>

  <!-- ========================== Base build Targets ===================
       Here we have one target building the classes and interfaces that make
       up the access control suite.
       ================================================================= -->

  <target name="clean-build" depends="clean,build"
          description="Clean and compile webdav classes"/>

  <target name="clean-build-all" depends="clean,build-all"
          description="Clean and compile webdav classes"/>

  <target name="build" depends="init,build-source,cleanup"
          description="Compile webdav classes"/>

  <target name="build-all" depends="init,build-source,cleanup"
          description="Compile webdav classes"/>

  <!-- ===================== bld.all Target ===============================
     This target builds jar files ready for the deploy target.
     =================================================================== -->

  <target name="build-source" depends="bld.server,
                                       bld.bwcaldav,
                                       bld.boeingexchange,
                                       bld.domino,
                                       bld.google" />

<!-- ==================== Javadoc Target ===============================
     The "javadoc" target creates Javadoc API documentation for the Java
     classes included in your application.  Normally, this is only required
     when preparing a distribution release, but is available as a separate
     target in case the developer wants to create Javadocs independently.
     =================================================================== -->

  <target name="javadoc" depends="init"
          description="Create Javadoc API documentation">
    <property name="destdir" location="${dist.home}/docs/api"/>
    <mkdir dir="${destdir}"/>

    <javadoc sourcepath="${org.bedework.caldav.boeingexchange.base}/src:
                         ${org.bedework.caldav.bwcaldav.base}/src:
                         ${org.bedework.caldav.domino.base}/src:
                         ${org.bedework.caldav.google.base}/src:
                         ${org.bedework.caldav.server.base}/src:"
           classpathref="compile.classpath"
                destdir="${destdir}"
           packagenames="org.bedework.*,
                         edu.rpi.*"
                 access="public"
                 author="true"
                version="true"
          breakiterator="yes"
            windowtitle="${project.name} ${project.version} API Documentation">
      <doctitle><![CDATA[${project.name} ${project.version}<br/>API Documentation]]></doctitle>
      <header><![CDATA[${project.name} ${project.version}<br/>API Documentation]]></header>
      <link href="../../access/api" />
      <link href="../../calendarapi/api" />
      <link href="../../davutil/api" />
      <link href="../../rpiutil/api" />
      <link href="../../webdav/api" />
      <link href="${env.JAVA_HOME}/docs/api" />
    </javadoc>
  </target>

  <!-- ===================== internal build targets ====================
       ================================================================= -->

  <target name="bld.boeingexchange" >
    <echo message="org.bedework.build.caldav.bexchange=${org.bedework.build.caldav.bexchange}" />
      <ant antfile="${org.bedework.caldav.boeingexchange.base}/build.xml" inheritrefs="true"
           target="build" />
  </target>

  <target name="bld.bwcaldav" >
      <ant antfile="${org.bedework.caldav.bwcaldav.base}/build.xml"
           inheritrefs="true"
           target="build" />
  </target>

  <target name="bld.domino" >
      <ant antfile="${org.bedework.caldav.domino.base}/build.xml" inheritrefs="true"
           target="build" />
  </target>

  <target name="bld.google" >
      <ant antfile="${org.bedework.caldav.google.base}/build.xml" inheritrefs="true"
           target="build" />
  </target>

  <target name="bld.server">
      <ant antfile="${org.bedework.caldav.server.base}/build.xml" inheritrefs="true"
           target="build" />
  </target>
</project>
